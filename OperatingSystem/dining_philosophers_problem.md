# Dining philosophers problem (식사하는 철학자 문제)
- 운영체제의 교착(Deadlock)상채를 설명하기 위한 무네

## Philosophers의 행동 순서 설명
- 5명의 철학자가 원탁에 앉아서 식사를 한다
- 철학자들 사이에는 포크가 하나씩 놓여있다 
- 철학자들은 특별한 과정의 반복 통해 식사를 한다
> 1. 왼쪽 포크가 사용 가능해질 때까지 생각을 한다. 만약 사용 가능해지면 집어든다
> 2. 오른쪽 포크가 사용 가능해질 때까지 생각을 한다. 만약 사용 가능해지면 집어든다
> 3. 양쪽의 포크를 잡으면 정해진 시간만큼 식사를 한다
> 4. 오른쪽 포크를 내려놓는다
> 5. 왼쪽 포크를 내려놓는다

### 문제상황
- 모든 철학자들이 동시에 자신의 왼쪽 포크를 잡는다면?
	- 모든 철학자가 오른쪽 포크가 사용 가능해 질 때까지 대기한다
	- 모든 철학자가 3번을 수행하지 않았으므로 4번 또한 수행하지 않는다
	- 모든 철학자가 오른쪽 포크를 기다리고 있는 교착 상태에 빠진다

### 해결책
#### OS 차원의 해결법
- 한 철학자가 포크를 잡는 행동을 할 때, 반대쪽 포크를 잡을 때까지의 행동권을 넘길 수 없게 하는 것
	- 즉, 1~2를 한 동작으로 묶어서 수행하게 하는것
		- 1~2를 수행중에 인터럽트가 발생할 수 있으므로, 인터럽트를 무시하는 것이다
		- 이것은 커널 영역에서만 가능하다
			- 이 방식은 사용자에게 인터럽트 제어권을 넘겨주는 것이므로, 사용자 혼자 CPU(여기선 포크)를 독점하는 상황이 발생할 수 있다
	- 멀티 쓰레드환경에서는 자신이 만든 다른 쓰레드가 CPU를 잡지 못하게 만들어 쓰레드간의 교착 상태를 방지할 수 있다
		- Semaphore, Mutex lock등을 이용해 Critical Section애서 사용 가능
#### 하드웨어 아키텍쳐 차원의 해결법
- 양쪽 포크를 동시에 잡게하는 명령어를 사용하면 된다
	- 두 철학자가 동시에 하나의 포크만 잡는 상황은 벌어지지 않는다
	- Atomic Instruction
		- 명령어를 쪼갤수 없게 한 것
#### 소프트웨어 차원의 해결법
1. 타임아웃 설정
	- 설정된 시간 내에 다른쪽 포크를 획득하는데 실패 한다면, 다른쪽 포크를 반납하게 하는 것
2. 철학자들 마다 다른 방향의 포크를 잡게 한다
	- 번갈아 가면서 포크를 잡게 되면, 1번이 왼쪽 포크를 들면, 2번이 오른쪽 포크를 먼저 들려고 할 때, 오른쪽 포크가 없으므로 대기상태가 된다
3. 포크 하나에 비교 가능한 고유 값을 부여하여 값을 기준으로 포크를 잡게 하는 방법
	- 값에 따라 잡는 포크가 결정되기 때문에 모든 철학자가 대기상태가 되지 않는다
	
---
## 참고링크
- [식사하는 철학자들 문제](https://ko.wikipedia.org/wiki/식사하는_철학자들_문제)
- [식사하는 철학자 문제](https://namu.wiki/w/식사하는%20철학자%20문제)